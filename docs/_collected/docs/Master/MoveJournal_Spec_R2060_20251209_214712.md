# Move/Undo-Journal – Spezifikation (R2060)

Erstellt durch: R2060
Datum: 2025-12-09T21:47:12

## 1. Ziel

Dieses Dokument definiert das Verhalten des Move/Undo-Journals für ShrimpDev.

- Sichere Dateioperationen auf Basis der TreeView-Auswahl (Multi-Select + Lasso).
- Unterstützte Operationen:
  - Mehrfach-Löschen (delete)
  - Mehrfach-Umbenennen (rename)
  - Verschieben/Umhängen von Dateien (move)
- Jede Operation ist nachvollziehbar (Journal) und rückgängig machbar (Undo).

Es werden keine destruktiven Operationen ohne Journal durchgeführt.

## 2. Randbedingungen

1. Alle Operationen laufen relativ zum aktuellen Workspace-Root (Projekt-Root).
2. Vor einer destruktiven Operation müssen mindestens erfüllt sein:
   - gültige Pfade,
   - Schreibrechte,
   - freier Speicher für Kopiervorgänge.
3. Für jeden Vorgang gilt:
   - erst kopieren/verschieben und validieren, dann Quelle löschen.
4. Das Journal muss auch nach einem Crash noch interpretierbar sein (Text/JSON).

## 3. Datenmodell des Journals (Kurzfassung)

Jede Operation wird als JSON-ähnliches Objekt protokolliert mit:
- id, timestamp, runner_id, user
- op_type (delete | move | rename)
- status (planned | applied | undone | failed)
- paths (src, dst, backup)
- meta (reason, batch_id, optionale Hashes).

Mehrere Operationen können zu einem Batch (batch_id) zusammengefasst werden.

## 4. Operationstypen (Überblick)

Delete:
- Datei wird in einen Trash-Bereich (z. B. _Trash/...) verschoben, nicht direkt gelöscht.
- Journal speichert src und backup.

Move:
- Datei wird innerhalb des Workspace verschoben (src → dst).

Rename:
- Spezialfall Move im gleichen Ordner (nur Name ändert sich).

## 5. Undo-Strategie (Überblick)

- Undo arbeitet auf Basis des Journals (LIFO oder per batch_id).
- Delete-Undo: Wiederherstellung von backup nach src, sofern möglich.
- Move/Rename-Undo: Verschieben von dst zurück nach src.

## 6. Integration in ShrimpDev (geplant)

- TreeView-Mehrfachauswahl liefert Pfadlisten über ui_project_tree.get_selected_paths(app).
- Kontextmenü/Toolbar verwenden das MoveJournal für Delete/Move/Rename.
- Undo-Funktion: arbeitet über Journal-Einträge (letzte Aktion oder Batch).

## 7. Sicherheitsregeln

- Keine Massenoperationen ohne Journal.
- Keine stillen Fehler: Probleme werden im Journal als failed dokumentiert.
- Kein direktes Löschen ohne Trash/Backup.
- Kompatibilität mit bestehenden Snapshots bleibt erhalten.

## 8. Nächste Schritte

- Modul modules/move_journal.py gemäß dieser Spezifikation implementieren.
- GUI-Hooks für Delete/Move/Rename und Undo anbinden.
- Tests und Dry-Runs für typische Edge-Cases durchführen.
